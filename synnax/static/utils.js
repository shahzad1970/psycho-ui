/*
 * Color map for UI color palette
 */
const uiColorMap = {
    'primary-dark': {
        bg: "#001E60",
        fg: "#ffffff"
    },
    'primary-light': {
        bg: "#0047BB",
        fg: "#ffffff"
    },
    'secondary-dark': {
        bg: "#097A49",
        fg: "#ffffff"
    },
    'secondary-light': {
        bg: "#48D597",
        fg: "#000000"
    },
    'success': {
        bg: "#097A49",
        fg: "#ffffff"
    },
    'info': {
        bg: "#0047BB",
        fg: "#ffffff"
    },
    'danger': {
        bg: "#B50D12",
        fg: "#ffffff"
    },
    'warning': {
        bg: "#A66102",
        fg: "#ffffff"
    },
    'base': {
        bg: "#ffffff",
        fg: "#000000"
    },
    'dark': {
        bg: "#000000",
        fg: "#ffffff"
    },
    'grey-1': {
        bg: "#242526",
        fg: "#ffffff"
    },
    'grey-2': {
        bg: "#313336",
        fg: "#ffffff"
    },
    'grey-3': {
        bg: "#3f4145",
        fg: "#ffffff"
    },
    'grey-4': {
        bg: "#53565a",
        fg: "#ffffff"
    },
    'grey-5': {
        bg: "#72767a",
        fg: "#ffffff"
    },
    'grey-6': {
        bg: "#8e9399",
        fg: "#000000"
    },
    'grey-7': {
        bg: "#acb0b5",
        fg: "#000000"
    },
    'grey-8': {
        bg: "#d0d4d9",
        fg: "#000000"
    },
    'grey-9': {
        bg: "#edf0f2",
        fg: "#000000"
    },
    'grey-10': {
        bg: "#f8f9f9",
        fg: "#000000"
    },
    'red-1': {
        bg: "#471819",
        fg: "#ffffff"
    },
    'red-2': {
        bg: "#691518",
        fg: "#ffffff"
    },
    'red-3': {
        bg: "#8f0e13",
        fg: "#ffffff"
    },
    'red-4': {
        bg: "#b50d12",
        fg: "#ffffff"
    },
    'red-5': {
        bg: "#de1b21",
        fg: "#ffffff"
    },
    'red-6': {
        bg: "#fa5056",
        fg: "#000000"
    },
    'red-7': {
        bg: "#fc9094",
        fg: "#000000"
    },
    'red-8': {
        bg: "#fcc7c9",
        fg: "#000000"
    },
    'red-9': {
        bg: "#fce8e9",
        fg: "#000000"
    },
    'red-10': {
        bg: "#fff5f5",
        fg: "#000000"
    },
    'pink-1': {
        bg: "#451726",
        fg: "#ffffff"
    },
    'pink-2': {
        bg: "#661430",
        fg: "#ffffff"
    },
    'pink-3': {
        bg: "#8c0e38",
        fg: "#ffffff"
    },
    'pink-4': {
        bg: "#b30c44",
        fg: "#ffffff"
    },
    'pink-5': {
        bg: "#db1a5b",
        fg: "#ffffff"
    },
    'pink-6': {
        bg: "#f74f87",
        fg: "#000000"
    },
    'pink-7': {
        bg: "#fa8eb2",
        fg: "#000000"
    },
    'pink-8': {
        bg: "#fcc7d9",
        fg: "#000000"
    },
    'pink-9': {
        bg: "#fce8ef",
        fg: "#000000"
    },
    'pink-10': {
        bg: "#fcf5f7",
        fg: "#000000"
    },
    'purple-1': {
        bg: "#371c52",
        fg: "#ffffff"
    },
    'purple-2': {
        bg: "#4d2378",
        fg: "#ffffff"
    },
    'purple-3': {
        bg: "#642b9e",
        fg: "#ffffff"
    },
    'purple-4': {
        bg: "#7e40bd",
        fg: "#ffffff"
    },
    'purple-5': {
        bg: "#9557d4",
        fg: "#ffffff"
    },
    'purple-6': {
        bg: "#b277ed",
        fg: "#000000"
    },
    'purple-7': {
        bg: "#cda3f7",
        fg: "#000000"
    },
    'purple-8': {
        bg: "#e2cdf7",
        fg: "#000000"
    },
    'purple-9': {
        bg: "#f2ebfa",
        fg: "#000000"
    },
    'purple-10': {
        bg: "#faf7fc",
        fg: "#000000"
    },
    'indigo-1': {
        bg: "#222261",
        fg: "#ffffff"
    },
    'indigo-2': {
        bg: "#2b2b94",
        fg: "#ffffff"
    },
    'indigo-3': {
        bg: "#3939bd",
        fg: "#ffffff"
    },
    'indigo-4': {
        bg: "#4f4fdb",
        fg: "#ffffff"
    },
    'indigo-5': {
        bg: "#6666e3",
        fg: "#ffffff"
    },
    'indigo-6': {
        bg: "#8787fa",
        fg: "#000000"
    },
    'indigo-7': {
        bg: "#adadff",
        fg: "#000000"
    },
    'indigo-8': {
        bg: "#d1d1ff",
        fg: "#000000"
    },
    'indigo-9': {
        bg: "#ededff",
        fg: "#000000"
    },
    'indigo-10': {
        bg: "#f7f7ff",
        fg: "#000000"
    },
    'navy-1': {
        bg: "#001238",
        fg: "#ffffff"
    },
    'navy-2': {
        bg: "#001e60",
        fg: "#ffffff"
    },
    'navy-3': {
        bg: "#00308a",
        fg: "#ffffff"
    },
    'navy-4': {
        bg: "#0047bb",
        fg: "#ffffff"
    },
    'navy-5': {
        bg: "#005bed",
        fg: "#ffffff"
    },
    'navy-6': {
        bg: "#4289f5",
        fg: "#000000"
    },
    'navy-7': {
        bg: "#8cb6f5",
        fg: "#000000"
    },
    'navy-8': {
        bg: "#c0d7fa",
        fg: "#000000"
    },
    'navy-9': {
        bg: "#e6f0ff",
        fg: "#000000"
    },
    'navy-10': {
        bg: "#f5f8fc",
        fg: "#000000"
    },
    'blue-1': {
        bg: "#0c2b3b",
        fg: "#ffffff"
    },
    'blue-2': {
        bg: "#093d57",
        fg: "#ffffff"
    },
    'blue-3': {
        bg: "#064e73",
        fg: "#ffffff"
    },
    'blue-4': {
        bg: "#066594",
        fg: "#ffffff"
    },
    'blue-5': {
        bg: "#0d7db5",
        fg: "#ffffff"
    },
    'blue-6': {
        bg: "#239cd9",
        fg: "#000000"
    },
    'blue-7': {
        bg: "#53bff5",
        fg: "#000000"
    },
    'blue-8': {
        bg: "#b0def5",
        fg: "#000000"
    },
    'blue-9': {
        bg: "#e1f2fa",
        fg: "#000000"
    },
    'blue-10': {
        bg: "#f2f9fc",
        fg: "#000000"
    },
    'teal-1': {
        bg: "#082e2b",
        fg: "#ffffff"
    },
    'teal-2': {
        bg: "#06403b",
        fg: "#ffffff"
    },
    'teal-3': {
        bg: "#07524b",
        fg: "#ffffff"
    },
    'teal-4': {
        bg: "#056960",
        fg: "#ffffff"
    },
    'teal-5': {
        bg: "#038277",
        fg: "#ffffff"
    },
    'teal-6': {
        bg: "#0aa396",
        fg: "#000000"
    },
    'teal-7': {
        bg: "#1ec7b9",
        fg: "#000000"
    },
    'teal-8': {
        bg: "#abe0dc",
        fg: "#000000"
    },
    'teal-9': {
        bg: "#d7f5f2",
        fg: "#000000"
    },
    'teal-10': {
        bg: "#edfaf9",
        fg: "#000000"
    },
    'mint-1': {
        bg: "#0a2e1e",
        fg: "#ffffff"
    },
    'mint-2': {
        bg: "#094028",
        fg: "#ffffff"
    },
    'mint-3': {
        bg: "#075433",
        fg: "#ffffff"
    },
    'mint-4': {
        bg: "#097a49",
        fg: "#ffffff"
    },
    'mint-5': {
        bg: "#12995f",
        fg: "#ffffff"
    },
    'mint-6': {
        bg: "#27b875",
        fg: "#000000"
    },
    'mint-7': {
        bg: "#48d597",
        fg: "#000000"
    },
    'mint-8': {
        bg: "#abe0c9",
        fg: "#000000"
    },
    'mint-9': {
        bg: "#daf5e9",
        fg: "#000000"
    },
    'mint-10': {
        bg: "#edfaf3",
        fg: "#000000"
    },
    'green-1': {
        bg: "#1e2b0a",
        fg: "#ffffff"
    },
    'green-2': {
        bg: "#283d09",
        fg: "#ffffff"
    },
    'green-3': {
        bg: "#344f0b",
        fg: "#ffffff"
    },
    'green-4': {
        bg: "#3f6605",
        fg: "#ffffff"
    },
    'green-5': {
        bg: "#4e8003",
        fg: "#ffffff"
    },
    'green-6': {
        bg: "#689e18",
        fg: "#000000"
    },
    'green-7': {
        bg: "#8cc63f",
        fg: "#000000"
    },
    'green-8': {
        bg: "#c6dba7",
        fg: "#000000"
    },
    'green-9': {
        bg: "#e4f2ce",
        fg: "#000000"
    },
    'green-10': {
        bg: "#f2fae6",
        fg: "#000000"
    },
    'yellow-1': {
        bg: "#36240c",
        fg: "#ffffff"
    },
    'yellow-2': {
        bg: "#4d310b",
        fg: "#ffffff"
    },
    'yellow-3': {
        bg: "#663e07",
        fg: "#ffffff"
    },
    'yellow-4': {
        bg: "#854e03",
        fg: "#ffffff"
    },
    'yellow-5': {
        bg: "#a66102",
        fg: "#ffffff"
    },
    'yellow-6': {
        bg: "#c97d12",
        fg: "#000000"
    },
    'yellow-7': {
        bg: "#e6a243",
        fg: "#000000"
    },
    'yellow-8': {
        bg: "#f5cc93",
        fg: "#000000"
    },
    'yellow-9': {
        bg: "#faecd9",
        fg: "#000000"
    },
    'yellow-10': {
        bg: "#fff8ed",
        fg: "#000000"
    },
    'orange-1': {
        bg: "#3d1e14",
        fg: "#ffffff"
    },
    'orange-2': {
        bg: "#5e2413",
        fg: "#ffffff"
    },
    'orange-3': {
        bg: "#80280d",
        fg: "#ffffff"
    },
    'orange-4': {
        bg: "#a6310d",
        fg: "#ffffff"
    },
    'orange-5': {
        bg: "#c94218",
        fg: "#ffffff"
    },
    'orange-6': {
        bg: "#e8663f",
        fg: "#000000"
    },
    'orange-7': {
        bg: "#f2997e",
        fg: "#000000"
    },
    'orange-8': {
        bg: "#f5ccbf",
        fg: "#000000"
    },
    'orange-9': {
        bg: "#fce9e3",
        fg: "#000000"
    },
    'orange-10': {
        bg: "#faf6f5",
        fg: "#000000"
    },
}

const uiSizeMap = {
    'xx-small': '0.5625em',
    'x-small': '0.625em',
    'small': '0.8333em',
    'medium': '1em',
    'large': '1.125em',
    'x-large': '1.5em',
    'xx-large': '2em',
    'xxx-large': '3em'
}

const uiSizes = ['xx-small', 'x-small', 'small', 'medium', 'large', 'x-large', 'xx-large', 'xxx-large'];

function getUiSize(size) {
    return uiSizeMap[size] ? uiSizeMap[size] : size;
}

/*
 * @param {HTMLElement} element - The element to set the color on
 * @param {string} color - color name or color value
 */
function setUiForgroundColor(element, color) {
    let c = uiColorMap[color] ? uiColorMap[color].bg : color;
    element.style.color = c;
    element.style.setProperty('--ui-color-shadow', tinycolor(c).setAlpha(0.18).toRgbString());

}

/*
 * @param {HTMLElement} element - The element to set the color on
 * @param {string} color - color name or color value
 * @param {string} bgColor - background color name or color value
 */
function setUiBackgroundColor(element, color, hasColor) {
    let c = uiColorMap[color] ? uiColorMap[color].bg : color;
    element.style.setProperty('--ui-color-lighten', tinycolor(c).lighten(25).toHexString());
    element.style.setProperty('--ui-color-darken', tinycolor(c).darken(25).toHexString());
    let colors = [];

    let splitcomplement = tinycolor(c).splitcomplement();
    let monochromatic = tinycolor(c).monochromatic();
    let triad = tinycolor(c).triad();
    let tetrad = tinycolor(c).tetrad();

    colors = [splitcomplement[1].toHexString(), triad[1].toHexString(), tetrad[1].toHexString()];
    let accent = tinycolor.mostReadable(c, colors).toHexString();

    if (tinycolor.readability(c, accent) < 1.1) {
        accent = monochromatic[3].toHexString();
    }
    element.style.setProperty('--ui-color-accent', accent);
    element.style.setProperty('--ui-color-accent-lighten', tinycolor(accent).setAlpha(0.5).toRgbString());

    colors = [splitcomplement[2].toHexString(), triad[2].toHexString(), tetrad[2].toHexString(), tetrad[3].toHexString()];
    accent = tinycolor.mostReadable(c, colors).toHexString();
    if (tinycolor.readability(c, accent) < 1.1) {
        accent = monochromatic[5].toHexString();
    }
    element.style.setProperty('--ui-color-highlight', accent);
    let readable = tinycolor.mostReadable(c, ["#ffffff", "#000000"]);
    element.style.color = readable;
    element.style.setProperty('--ui-color-shadow', tinycolor("#000000").setAlpha(0.15).toRgbString());
    element.style.backgroundColor = c;
    element.style.setProperty('--ui-color-background', c);
}

function setUiAccentColor(element, color) {
    let c = uiColorMap[color] ? uiColorMap[color].bg : color;
    element.style.setProperty('--ui-color-accent', c);
    element.style.setProperty('--ui-color-accent-lighten', tinycolor(c).setAlpha(0.5).toRgbString());
}


function setUiBoxShadow(element, size) {
    switch (size) {
        case 'xx-small': {
            element.style.boxShadow = `0 1px 1px 0 var(--ui-color-shadow), 0 2px 1px -1px var(--ui-color-shadow), 0 1px 3px 0 var(--ui-color-shadow)`;
            break;
        }
        case 'x-small': {
            element.style.boxShadow = `0 2px 2px 0 var(--ui-color-shadow), 0 3px 1px -2px var(--ui-color-shadow), 0 1px 5px 0 var(--ui-color-shadow)`;
            break;
        }
        case 'small': {
            element.style.boxShadow = `0 3px 4px 0 var(--ui-color-shadow), 0 3px 3px -2px var(--ui-color-shadow), 0 1px 8px 0 var(--ui-color-shadow)`;
            break;
        }
        case 'medium': {
            element.style.boxShadow = `0 4px 5px 0 var(--ui-color-shadow), 0 1px 10px 0 var(--ui-color-shadow), 0 2px 4px -1px var(--ui-color-shadow)`;
            break;
        }
        case 'large': {
            element.style.boxShadow = `0 6px 10px 0 var(--ui-color-shadow), 0 1px 18px 0 var(--ui-color-shadow), 0 3px 5px -1px var(--ui-color-shadow)`;
            break;
        }
        case 'x-large': {
            element.style.boxShadow = `0 8px 10px 1px var(--ui-color-shadow), 0 3px 14px 2px var(--ui-color-shadow), 0 5px 5px -3px var(--ui-color-shadow)`;
            break;
        }
        case 'xx-large': {
            element.style.boxShadow = `0 9px 12px 1px var(--ui-color-shadow), 0 3px 16px 2px var(--ui-color-shadow), 0 5px 6px -3px var(--ui-color-shadow)`;
            break;
        }
        case 'xxx-large': {
            element.style.boxShadow = `0 12px 17px 2px var(--ui-color-shadow), 0 5px 22px 4px var(--ui-color-shadow), 0 7px 8px -4px var(--ui-color-shadow)`;
            break;
        }

    }
}


String.prototype.escapeHtml = function () {
    return this.replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

String.prototype.formatXml = function () {
    const PADDING = ' '.repeat(2); // set desired indent size here
    const reg = /(>)(<)(\/*)/g;
    let pad = 0;
    let xml = this;
    xml = xml.replace(reg, '$1\r\n$2$3');

    return xml.split('\r\n').map((node, index) => {
        let indent = 0;
        if (node.match(/.+<\/\w[^>]*>$/)) {
            indent = 0;
        } else if (node.match(/^<\/\w/) && pad > 0) {
            pad -= 1;
        } else if (node.match(/^<\w[^>]*[^\/]>.*$/)) {
            indent = 1;
        } else {
            indent = 0;
        }

        pad += indent;

        return PADDING.repeat(pad - indent) + node + '\r\n';
    }).join('\r\n');
}
